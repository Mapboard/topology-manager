#!/usr/bin/env coffee
{argv} = require 'yargs'
{db,sql, proc} = require '../src/util'
colors = require 'colors'

count = "SELECT count(*) nlines
         FROM map_digitizer.linework
         WHERE geometry_hash IS null"

do ->
  {nlines} = await db.one count
  console.log "#{nlines} remaining"
  while nlines > 0
    try
      await db.query sql('procedures/update-contact')
    catch err
      console.error "#{err}".red
      process.exit(1)
    {nlines} = await db.one count
    console.log "#{nlines} remaining"

  process.exit()


